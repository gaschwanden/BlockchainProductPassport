<!DOCTYPE html>

<html>

<head>
	<title> Product Passport Tracking System<span> ppc </title>
		<meta charset="utf-8" />
		<!-- <link rel="shortcut icon" href="https://s24.postimg.org/t6rucdmid/ETHEREUM_YOUTUBE_PROFILE_PIC.png" type="image/png"> -->
		<link rel="icon" href="https://s24.postimg.org/t6rucdmid/ETHEREUM_YOUTUBE_PROFILE_PIC.png" type="image/png">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" type="text/css" href="../fontawesome-free-5.0.12/web-fonts-with-css/css/fontawesome-all.min.css">
		<link rel="stylesheet" type="text/html" href="./bootstrap-3.3.7-dist/css/bootstrap.min.css">
			
		<link rel="stylesheet" href="./assets/css/main.css" />
		<link rel="stylesheet" href="./assets/css/extra.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->

		<script src="../node_modules/jquery/dist/jquery.min.js"></script>
		<script src="../node_modules/jquery/dist/jquery.dropotron.min.js"></script>
		<script src="../node_modules/jquery/dist/jquery.scrolly.min.js"></script>
        <script src="../node_modules/jquery/dist/jquery.scrollgress.min.js"></script>
        <script src="../node_modules/jquery/dist/jquery.scrollgress.min.js"></script>
              

	    <script type="text/javascript" src="assets/js/llqrcode.js"></script>
        <script type="text/javascript" src="assets/js/webqr.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>		
	

		<script type="text/javascript" src="../node_modules/jquery/dist/jquery.subwayMap-0.5.0.js"></script>
		<script src="assets/js/data.js"></script>

        </head>
            <body class="index">
                <div id="page-wrapper">
                    <!-- Header -->
                        <header id="header" class="alt">
                            <h1 id="logo"><a href="index.html">Product Passport <strong> Supply Chain Tracking System  </strong></a></h1>
                            <nav id="nav">
                                <ul>
                                    <li class="current"><a href="tracker.html">Tracker</a></li>
                                    <li><a href="faq.html">FAQ</a></li>
                                    <li>
                                        <a href="https://github.com/anrodon/tracking-blockchain" class="icon fa-github" style="font-size: 25px; padding: 0.05em 0.3em; top: 0.1em;"></a>
                                    </li>
                                </ul>
                            </nav>
                        </header>

        <!-- Banner -->
        
		<section id="banner">
			<div class="inner">

				<header>
					<h2>Product Tracker</h2>
					<p>Get inside</p>
                </header>
                <div class="container">
                    <h1>Product</h1>
                    
                    <span id="countIns"></span> 
                    
                    <h3 id="ProductsInfo"></h3>
                    <span id="insTrans"></span>
                   
                    <hr>  
                    <!--img id="loader" src="https://loading.io/spinners/double-ring/lg.double-ring-spinner.gif"-->
                    <body for="ProductName" class="col-lg-2 control-label">Product Name</body>
                    <input id="ProductName" type="text">  

                    <label for="attributeName" class="col-lg-2 control-label">Attribute Name</label>
                    <input id="attributeName" type="text">
            
                    <label for="values" class="col-lg-2 control-label">Values</label>
                    <input id="values" type="text">

                    <label for="parentProducts" class="col-lg-2 control-label">ParentProducts</label>
                    <input id="parentProducts" type="text">           
                    
                    <label for="longitude" class="col-lg-2 control-label">longitude</label>
                    <input id="longitude" type="text">


                    <label for="latitude" class="col-lg-2 control-label">latitude</label>
                    <input id="latitude" type="text">
            
                    <label for="PRODUCT_FACTORY" class="col-lg-2 control-label">Product Factory</label>
                    <input id="PRODUCT_FACTORY" type="text">
            
                    <button id="button">Create product</button>
                    <button id="button2">Create product address</button>
                    <button id="button3">reset product address</button>

                    <span id="insTrans"></span>
                 
                </div>
                
                <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>           
               
                <script type="text/javascript" src="./assets/js/ProductABI.js"></script>
                <script type="text/javascript" src="./Bytescode/ProductBytecode.js"></script>

                <script>
                    window.addEventListener('load', function() {
                        // Checking if Web3 has been injected by the browser (Mist/MetaMask)
                        if (typeof web3 !== 'undefined') {
                            // Use the browser's ethereum provider
                            //var provider = web3.currentProvider
                            //console.log(provider)
                            console.log('web3?')
                            console.log(web3.eth.accounts[0])
                        } else {
                            console.log('No web3? You should consider trying MetaMask!')
                        }
                    })
                    //ProductFactory:0x345ca3e014aaf5dca488057592ee47305d9b3e10
                    var productAddress = sessionStorage.getItem('productAddress');
                    console.log("getProductContractAddress" + productAddress)
                    var browser_product_sol_productContract = web3.eth.contract([{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"childProducts","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newProductsNames","type":"bytes32"},{"name":"description","type":"bytes32"},{"name":"_newAttributeNames","type":"bytes32[]"},{"name":"_newValues","type":"uint256[]"},{"name":"lon","type":"uint256"},{"name":"lat","type":"uint256"},{"name":"_consumed","type":"bool"}],"name":"addAction","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"owner_","type":"address"}],"name":"setOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"logProductInfo","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getAttributes","outputs":[{"name":"","type":"bytes32[]"},{"name":"","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"otherProducts","type":"address[]"},{"name":"newProductName","type":"bytes32"},{"name":"_newAttributeName","type":"bytes32[]"},{"name":"_newValues","type":"uint256[]"},{"name":"lon","type":"uint256"},{"name":"lat","type":"uint256"}],"name":"merge","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"consume","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_name","type":"bytes32"}],"name":"getAttributeByName","outputs":[{"name":"","type":"bytes32"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"lon","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getAttributeNames","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"lat","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"PRODUCT_FACTORY","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_attributeName","type":"bytes32[]"},{"name":"_values","type":"uint256[]"}],"name":"setAttributes","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"measurements","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"isConsumed","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"actions","outputs":[{"name":"handler","type":"address"},{"name":"description","type":"bytes32"},{"name":"lon","type":"uint256"},{"name":"lat","type":"uint256"},{"name":"timestamp","type":"uint256"},{"name":"blockNumber","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"owner_","type":"address"}],"name":"transferOwnerShip","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"newProductAddress","type":"address"},{"name":"lon","type":"uint256"},{"name":"lat","type":"uint256"}],"name":"collaborateInMerge","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getAttributeValues","outputs":[{"name":"","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"attributes","outputs":[{"name":"attributeName","type":"bytes32"},{"name":"value","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"parentProducts","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_name","type":"bytes32"},{"name":"_attributeName","type":"bytes32[]"},{"name":"_values","type":"uint256[]"},{"name":"_parentProducts","type":"address[]"},{"name":"_lon","type":"uint256"},{"name":"_lat","type":"uint256"},{"name":"_PRODUCT_FACTORY","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"payable":false,"stateMutability":"nonpayable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"name","type":"bytes32"},{"indexed":false,"name":"attributeNames","type":"bytes32[]"},{"indexed":false,"name":"values","type":"uint256[]"},{"indexed":false,"name":"parentProducts","type":"address[]"},{"indexed":false,"name":"lon","type":"uint256"},{"indexed":false,"name":"lat","type":"uint256"},{"indexed":false,"name":"PRODUCT_FACTORY","type":"address"}],"name":"ProductInfo","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newOwner","type":"address"}],"name":"SetTheOwner","type":"event"}]);
                     var browser_product_sol_product=browser_product_sol_productContract.at(productAddress);
                     console.log("browser_product_sol_product",browser_product_sol_product);

                     var ProductsEvent =browser_product_sol_product.ProductInfo({},'latest');
                    console.log("ProductsEvent",ProductsEvent);
                    
                    ProductsEvent.watch(function(error, result) {
                                if (!error) {
                                    if (result.blockHash != $("#insTrans").html())
                                            $("#loader").hide();
                                    $("#insTrans").html('Block hash: '+web3.toAscii(result.args.name) );
                                    console.log("successfule get event") 
                                    console.log('myEvent: ' + JSON.stringify(result.args));
                                    console.log("with web32"+JSON.stringify("the first attibutes is " + web3.toAscii(result.args.attributeNames[0]).replace(/\u0000/g, '')));
                                    console.log("with web33"+result.args.values)
                                    var attributes = browser_product_sol_product.attibutes;
                                    console.log(attributes);
                                    $("#ProductsInfo").html("prodcut Name:"+web3.toAscii(result.args.name)+ 'attriName' + web3.toAscii(result.args.attributeNames[0]).replace(/\u0000/g, '') + ' attriValue' + result.args.values[0]);
                                    
                                } else {
                                    console.log(error)
                                    $("#loader").hide();
                                }
                    });
                    
                    $("#button").click(function() {
                           // $("#loader").show();
                            
                            var getData2 = browser_product_sol_product.logProductInfo.getData();
                            web3.eth.sendTransaction(
                                {to:productAddress, from:web3.eth.accounts[0], data: getData2},
                                function (e,res){
                                    if(!e){
                                        console.log(res);
                                        console.log("the event log successfully2")
                                    } else{
                                        
                                        console.log(e);
                                    }
                                }
                            );
                            
                        });              
                        $("#button2").click(function() {
                            //$("#loader").show();
                            // var _name = $("#ProductName").val();
                            // var _attributeName = $("#attributeName").val().split(" ");
                            // var _values = $("#values").val().split(" ");
                            // var _parentProducts =$("#parentProducts").val().split(" ");
                            // var _lon = $("#longitude").val();
                            // var _lat = $("#latitude").val();
                            // var _PRODUCT_FACTORY = $("#PRODUCT_FACTORY").val();

                            var _name ='milk';
                            var _attributeName = ["color","weight"];
                            var _values =[1,2];
                            var _parentProducts =[];
                            var _lon =3;
                            var _lat =4;
                            var _PRODUCT_FACTORY = "0x345ca3e014aaf5dca488057592ee47305d9b3e10";


                            var browser_product_sol_product = browser_product_sol_productContract.new(
                            _name,
                            _attributeName,
                            _values,
                            _parentProducts,
                            _lon,
                            _lat,
                            _PRODUCT_FACTORY,
                            {
                                from: web3.eth.accounts[0], 
                                data: ProductBytecode, 
                                gas: '4277086'
                            }, 
                                function (e,contract){
                                    if(!e){
                                        console.log(contract);
                                    } else{
                                        console.log(e);
                                    }
                                if (typeof contract.address !== 'undefined') {
                                    console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                                    getProductContractAddress=contract.address+""
                                    console.log(getProductContractAddress)
                                    sessionStorage.setItem('productAddress',getProductContractAddress);
                                }
                               
                            }
                        )   
                        });
                        $("#button3").click(function() {
                                    sessionStorage.removeItem('productAddress');  
                        });
                </script>
            </div>
    
        </section>

		<!-- Main -->
		<article id="main">
			
            


		<!-- Footer -->
		<footer id="footer">
			<ul class="icons">
				<li><a href="https://github.com" class="icon circle fa-github"><span class="label">Github</span></a>
		</li>
		</ul>

		<ul class="copyright">
            <li>&copy; Product Passport - Supply Chain Tracking System</li>
            
			<li>2017</li>
		</ul>
		</footer>

		</div>

		<!-- Scripts -->
		<script src="assets/js/skel.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/async/2.1.4/async.js"></script>
		</body>

</html>


