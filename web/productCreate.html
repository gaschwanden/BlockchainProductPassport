<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

	<title>HTML Template</title>

	<!-- Google font -->
	<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CVarela+Round" rel="stylesheet">

	<!-- Bootstrap -->
	<link type="text/css" rel="stylesheet" href="../bootstrap-3.3.7-dist/css/bootstrap.min.css" />

	<!-- Owl Carousel -->
	<link type="text/css" rel="stylesheet" href="./assets/css/owl.carousel.css" />
	<link type="text/css" rel="stylesheet" href="./assets/css/owl.theme.default.css" />

	<!-- Magnific Popup -->
	<link type="text/css" rel="stylesheet" href="./assets/css/magnific-popup.css" />

	<!-- Font Awesome Icon -->
	<link rel="stylesheet" href="./assets/css/font-awesome.min.css">

	<!-- Custom stlylesheet -->
	<link type="text/css" rel="stylesheet" href="./assets/css/style.css" />
	<script type="text/javascript" src="assets/js/llqrcode.js"></script>
	<script type="text/javascript" src="assets/js/webqr.js"></script>
	<!-- <script type="text/javascript" src="../node_modules/jquery/dist/jquery.subwayMap-0.5.0.js"></script> -->

	<script type="text/javascript" src="./assets/js/ProductABI.js"></script>
    <script type="text/javascript" src="./Bytescode/ProductBytecode.js"></script>


	<!-- Custom src -->
	<script src="../node_modules/jquery/dist/jquery.min.js"></script>
	<script src="../node_modules/jquery/dist/jquery.dropotron.min.js"></script>
	<script src="../node_modules/jquery/dist/jquery.scrolly.min.js"></script>
    <script src="../node_modules/jquery/dist/jquery.scrollgress.min.js"></script>
	<script src="../node_modules/jquery/dist/jquery.scrollgress.min.js"></script>

	<!-- <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>	 -->
	<script src="../node_modules/web3/dist/web3.min.js"></script>

	<script src="assets/js/data.js"></script>

	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script> 

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
</head>

<body>

	<!-- Header -->
	<header>

		<!-- Nav -->
		<nav id="nav" class="navbar">
			<div class="container">

				<div class="navbar-header">
					<!-- Logo -->
					<div class="navbar-brand">
						<a href="../index.html">
							<img class="logo" src="assets/img/logo.png" alt="logo">
						</a>
					</div>
					<!-- /Logo -->

					<!-- Collapse nav button -->
					<div class="nav-collapse">
						<span></span>
					</div>
					<!-- /Collapse nav button -->
				</div>

				<!--  Main navigation  -->
				<ul class="main-nav nav navbar-nav navbar-right">
					<li><a href="../index.html#home">Home</a></li>
					<li><a href="../index.html#about">About</a></li>
					<li><a href="../index.html#portfolio">Portfolio</a></li>
					<li><a href="../index.html#service">Services</a></li>
					<li><a href="../index.html#pricing">Prices</a></li>
					<li><a href="../index.html#team">Team</a></li>
					<li class="has-dropdown"><a>Blog</a>
						<ul class="dropdown">
							<li><a href="#">blog post</a></li>
						</ul>
					</li>
					<li><a href="../index.html#contact">Contact</a></li>
				</ul>
				<!-- /Main navigation -->

			</div>
		</nav>
		<!-- /Nav -->

		<!-- header wrapper -->
		<div class="header-wrapper sm-padding bg-grey">
			<div class="container">
				<h2>Create Your Product</h2>
				<!-- <ul class="breadcrumb">
					<li class="breadcrumb-item"><a href="../index.html">Home</a></li>
					<li class="breadcrumb-item"><a href="../index.html#blog">Blog</a></li>
					<li class="breadcrumb-item active">Single Post</li>
				</ul> -->
			</div>
		</div>
		<!-- /header wrapper -->

	</header>
	<!-- /Header -->

	<!-- Blog -->
	<div id="blog" class="section md-padding">
		

		<!-- Container -->
		<div class="container">

				
			
			<!-- Row -->
			<div class="row">

				<!-- Main -->
				<main id="main" class="col-md-9">
					

						<div class="Input Information">
								<h3 class="title">Create your product</h3>

								
								<form onsubmit="return false;" id="myForm">
									<input class="input" id="ProductName" type="text" placeholder="ProductName">
									<input class="input" id="attributeNames" type="text" placeholder="attributeNames">
									<input class="input" id="values" type="text" placeholder="values">
									<input class="input" id="parentProducts" type="text" placeholder="parentProducts">
									<input class="input" id="longitude" type="text" placeholder="longitude">
									<input class="input" id="latitude" type="text" placeholder="latitude">
									<input class="PRODUCT_FACTORY" type="text" placeholder="PRODUCT_FACTORY">
									<!-- <input class="input" type="email" placeholder="Email"> -->
									<textarea placeholder="Add Your Commment"></textarea>
									<button type="submit" class="main-btn">Submit</button>
									<button id="button"  class="main-btn">Create product</button>
									<button id="button2"  class="main-btn">Create product address</button>
									<button id="button3"  class="main-btn">reset product address</button>
									<button id="button4"  class="main-btn">test address</button>
									<h3 id="ProductsName"></h3>
									<h3 id="ProductsInfo"></h3>
									<h4 id="insTrans"></h4>
									
									

									<script>
											window.addEventListener('load', function() {
												// Checking if Web3 has been injected by the browser (Mist/MetaMask)
												if (typeof web3 !== 'undefined') {
													// Use the browser's ethereum provider
													var provider = web3.currentProvider
													console.log(provider)
													console.log('web3?')
													console.log(web3.eth.accounts[0])
												} else {
													console.log('No web3? You should consider trying MetaMask!')
												}
											})
											//ProductFactory:0xecfcab0a285d3380e488a39b4bb21e777f8a4eac
											var productAddress = sessionStorage.getItem('productAddress');
											console.log("getProductContractAddress" + productAddress)
											var browser_product_sol_productContract = web3.eth.contract(ProductABI);




											 var browser_product_sol_product=browser_product_sol_productContract.at(productAddress);
											 console.log("browser_product_sol_product",browser_product_sol_product);
						
											 var ProductsEvent =browser_product_sol_product.ProductInfo({},'latest');
											console.log("ProductsEvent",ProductsEvent);
											
											ProductsEvent.watch(function(error, result) {
														if (!error) {
															if (result.blockHash != $("#insTrans").html())
																	$("#loader").hide();
															$("#insTrans").html('Block hash: '+ result.blockHash );
															console.log("successfule get event") 
															console.log('myEvent: ' + JSON.stringify(result.args));
															console.log("with web32"+JSON.stringify("the first attibutes is " + web3.toAscii(result.args.attributeNames[0]).replace(/\u0000/g, '')));
															console.log("with web33"+result.args.values)
															var attributes = browser_product_sol_product.attibutes;
															console.log(attributes)
															$("#ProductsName").html("Successful Create your "+web3.toAscii(result.args.name)+ ' And the Info is following' );
															$("#ProductsInfo").html(web3.toAscii(result.args.attributeNames[0]).replace(/\u0000/g, '') + ' is ' + result.args.values[0]+" "+web3.toAscii(result.args.attributeNames[1]).replace(/\u0000/g, '') + ' is ' + result.args.values[1]);
														} else {
															console.log(error)
															$("#loader").hide();
														}
											});
											
											// product milkshake: 0xeec918d74c746167564401103096d45bbd494b74
											// coffee 0x38cf23c52bb4b13f051aec09580a2de845a7fa35
											// milk 0xbaaa2a3237035a2c7fa2a33c76b44a8c6fe18e87

											$("#button").click(function() {
												   // $("#loader").show();
													
													var getData2 = browser_product_sol_product.logProductInfo.getData();
													web3.eth.sendTransaction(
														{to:productAddress, from:web3.eth.accounts[0], data: getData2},
														function (e,res){
															if(!e){
																console.log(res);
																console.log("the event log successfully2")
															} else{
																
																console.log(e);
															}
														}
													);
													
												}); 
												$("#button4").click(function() {
													var _name = $("#ProductName").val();
													var _attributeName = $("#attributeNames").val().split(" ");
													// var _values = $("#values").val();
													// var _parentProducts =$("#parentProducts").val();
													// var _lon = $("#longitude").val();
													// var _lat = $("#latitude").val();
													// var _PRODUCT_FACTORY = $("#PRODUCT_FACTORY").val();
													console.log("the name is _name"+_name)
													console.log("the attribute is"+_attributeName)
													console.log("the attribute is"+_attributeName[0])
													console.log("the attribute is"+_attributeName[1])
													//console.log("the value is"+_values);
													
												});
												
												$("#button2").click(function() {
													// Object.keys(a).forEach(function (key){
													// 	console.log(a[key]);
													// });
													var _name = $("#ProductName").val();
													var _attributeName = $("#attributeNames").val().split(" ");
													var _values = $("#values").val().split(" ");
													var _parentProducts =$("#parentProducts").val().split(" ");
													var _lon = $("#longitude").val();
													var _lat = $("#latitude").val();
													var _PRODUCT_FACTORY = $("#PRODUCT_FACTORY").val();
													console.log('before');
													setTimeout(function(){
														
														console.log("the name is _name"+_name);
														console.log("the attribute is"+_attributeName);
														console.log("the value is"+_values);
													},500);
													
													// var _name ='milk';
													// var _attributeName = ["color","weight"];
													// var _values =[10,200];
													// var _parentProducts =[];
													// var _lon =34;
													// var _lat =49;
													// var _PRODUCT_FACTORY = "0x345ca3e014aaf5dca488057592ee47305d9b3e10";
						
													console.log("111111111111111111111")
													var browser_product_sol_product = browser_product_sol_productContract.new(
													_name,
													_attributeName,
													_values,
													_parentProducts,
													_lon,
													_lat,
													_PRODUCT_FACTORY,
													{
														from: web3.eth.accounts[0], 
														data: ProductBytecode, 
														gas: '4277086'
													}, 
														function (e,contract){
															if(!e){
																console.log(contract);
															} else{
																console.log(e);
															}
														if (typeof contract.address !== 'undefined') {
															console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
															getProductContractAddress=contract.address+""
															console.log(getProductContractAddress)
															sessionStorage.setItem('productAddress',getProductContractAddress);
														}
													   
													}
												)   
												});
												$("#button3").click(function() {
															sessionStorage.removeItem('productAddress');  
												});
										</script>
								</form>
						</div>


					<div class="info">
						<!-- <div class="blog-img">
							<img class="img-responsive" src="assets/img/blog-post.jpg" alt="">
						</div> -->
			

						<!-- blog author -->
						<div class="load your picture">
							<div class="media">
								<div class="media-left">
									<!-- <img class="media-object" src="assets/img/author.jpg" alt=""> -->
								</div>
								<div class="media-body">
									<div class="media-heading">
										<h3>Load your picture here</h3>
										<button type="submit" class="main-btn">choose from local</button>
										
									</div>
									<p>Choose the picture of your product</p>
								</div>
							</div>
						</div>
						<!-- /blog author -->

						<!-- reply form -->
						<div class="reply-form">
							<h3 class="title">Leave a reply</h3>
							<form>
								<input class="input" type="text" placeholder="Name">
								<input class="input" type="email" placeholder="Email">
								<textarea placeholder="Add Your Commment"></textarea>
								<button type="submit" class="main-btn">Submit</button>
							</form>
						</div>
						<!-- /reply form -->
					</div>
				</main>
				<!-- /Main -->


				<!-- Aside -->
				<aside id="aside" class="col-md-3">

					<!-- Search -->
					<div class="widget">
						<div class="widget-search">
							<input class="search-input" type="text" placeholder="search">
							<button class="search-btn" type="button"><i class="fa fa-search"></i></button>
						</div>
					</div>
					<!-- /Search -->

					<!-- Recent Create -->
					<div class="widget">
						<h3 class="title">Recent Create</h3>
						<div class="widget-category">
							<a href="#">January<span>(7)</span></a>
							<a href="#">February<span>(142)</span></a>
							<a href="#">March<span>(74)</span></a>
						</div>
					</div>
					<!-- /Category -->

					<!-- Posts sidebar -->
					<div class="widget">
						<h3 class="title">Populare Buyer</h3>

						<!-- single post -->
						<div class="widget-post">
							<a href="#">
								<img src="assets/img/post1.jpg" alt=""> Buyer 1
							</a>
							
						</div>
						<!-- /single post -->

						<!-- single post -->
						<div class="widget-post">
							<a href="#">
								<img src="assets/img/post2.jpg" alt=""> Buyer 2
							</a>
							
						</div>
						<!-- /single post -->


						<!-- single post -->
						<div class="widget-post">
							<a href="#">
								<img src="assets/img/post3.jpg" alt=""> Buyer 3
							</a>
							
						</div>
						<!-- /single post -->

					</div>
					<!-- /Posts sidebar -->

					<!-- Tags -->
					<div class="widget">
						<h3 class="title">Tags</h3>
						<div class="widget-tags">
							<a href="#">Web</a>
							<a href="#">Blockchain</a>
							
						</div>
					</div>
					<!-- /Tags -->

				</aside>
				<!-- /Aside -->

			</div>
			<!-- /Row -->

		</div>
		<!-- /Container -->

	</div>
	<!-- /Blog -->

	<!-- Footer -->
	<footer id="footer" class="sm-padding bg-dark">

		<!-- Container -->
		<div class="container">

			<!-- Row -->
			<div class="row">

				<div class="col-md-12">

					<!-- footer logo -->
					<div class="footer-logo">
						<a href="../index.html"><img src="assets/img/logo-alt.png" alt="logo"></a>
					</div>
					<!-- /footer logo -->

					<!-- footer follow -->
					<ul class="footer-follow">
						<li><a href="#"><i class="fa fa-facebook"></i></a></li>
						<li><a href="#"><i class="fa fa-twitter"></i></a></li>
						<li><a href="#"><i class="fa fa-google-plus"></i></a></li>
						<li><a href="#"><i class="fa fa-instagram"></i></a></li>
						<li><a href="#"><i class="fa fa-linkedin"></i></a></li>
						<li><a href="#"><i class="fa fa-youtube"></i></a></li>
					</ul>
					<!-- /footer follow -->

					<!-- footer copyright -->
					<div class="footer-copyright">
						<p>Copyright © 2017. All Rights Reserved. Designed by <a href="https://colorlib.com" target="_blank">Colorlib</a></p>
					</div>
					<!-- /footer copyright -->

				</div>

			</div>
			<!-- /Row -->

		</div>
		<!-- /Container -->

	</footer>
	<!-- /Footer -->

	<!-- Back to top -->
	<div id="back-to-top"></div>
	<!-- /Back to top -->

	<!-- Preloader -->
	<div id="preloader">
		<div class="preloader">
			<span></span>
			<span></span>
			<span></span>
			<span></span>
		</div>
	</div>
	<!-- /Preloader -->

	<!-- jQuery Plugins -->
	<script type="text/javascript" src="assets/js/jquery.min.js"></script>
	<script type="text/javascript" src="assets/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="assets/js/owl.carousel.min.js"></script>
	<script type="text/javascript" src="assets/js/jquery.magnific-popup.js"></script>
	<script type="text/javascript" src="assets/js/main.js"></script>

</body>

</html>
